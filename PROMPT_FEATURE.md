# 提示词功能说明

## 功能概述

右侧边栏已改为【提示词库】模块，采用现代化渐变设计，支持预制和管理提示词，在发送消息时自动附加提示词内容。

## 设计特点

### 视觉设计
- **渐变背景**: 紫色到靛蓝的渐变色系，与整体 UI 风格统一
- **卡片式布局**: 每个提示词采用独立卡片设计，支持悬停和选中效果
- **图标系统**: 使用 Sparkles 图标突出提示词的智能特性
- **阴影效果**: 多层次阴影增强视觉层次感
- **动画过渡**: 流畅的缩放和颜色过渡动画

### 交互设计
- **选中状态**: 选中的提示词显示渐变背景和放大效果
- **悬停反馈**: 鼠标悬停时卡片轻微放大并显示阴影
- **滚动优化**: 自定义滚动条样式，更加美观

## 主要功能

### 1. 提示词列表
- 右侧边栏显示所有已保存的提示词
- 每个提示词显示**名称**和**简介**（不显示完整内容）
- 显示提示词总数统计
- 点击提示词可查看完整内容并编辑

### 2. 新建提示词
- 点击右上角渐变 `+` 按钮创建新提示词
- 填写三个字段：
  - **名称**: 提示词的标题
  - **简介**: 简短描述用途
  - **内容**: 详细的提示词文本
- 点击保存按钮完成创建

### 3. 编辑提示词
- 点击任意提示词打开全屏编辑弹框
- 弹框采用现代化设计：
  - 渐变头部区域
  - 大图标和标题
  - 分段式表单布局
  - 字符计数显示
- 可修改名称、简介和内容
- 支持删除操作（红色按钮）

### 4. 使用提示词
- 在编辑弹框中点击"使用此提示词"按钮（紫色渐变）
- 输入框下方会显示当前选中的提示词（绿色标签）
- 发送消息时，提示词内容会自动附加到消息前面
- 点击提示词标签上的 × 可取消使用

### 5. 本地存储
- 所有提示词数据存储在浏览器本地存储中
- 刷新页面后数据不会丢失
- 使用 Zustand persist 中间件实现

## 预制提示词

系统预制了 3 个常用提示词：

1. **代码审查**
   - 简介：全面审查代码质量、安全性和性能
   - 内容：关注代码质量、bug、性能和最佳实践

2. **文档生成**
   - 简介：自动生成详细的代码文档和注释
   - 内容：生成功能说明、参数说明、返回值和示例

3. **代码优化**
   - 简介：提升代码性能和可维护性
   - 内容：关注性能、简洁性、可维护性和最佳实践

## 技术实现

- **状态管理**: Zustand + persist 中间件
- **UI 组件**: 
  - `PromptSidebar` - 右侧提示词列表（72宽度）
  - `PromptModal` - 全屏编辑弹框（最大宽度 4xl）
- **类型定义**: `src/types/prompt.ts`
- **Store**: `src/stores/promptStore.ts`
- **样式**: Tailwind CSS + 渐变 + 动画

## 使用流程

1. 在右侧边栏浏览提示词（显示名称和简介）
2. 点击提示词卡片直接选中使用
3. 输入框下方会显示当前选中的提示词（绿色标签）
4. 在输入框输入你的具体问题或代码
5. 发送消息，系统会自动将提示词作为 system prompt 发送给 AI

## 技术实现细节

### 提示词传递方式

提示词不会显示在聊天消息中，而是作为系统提示（system prompt）在 API 请求中发送：

1. **选中提示词**：点击提示词卡片，调用 `selectPrompt(id)` 选中
2. **获取提示词内容**：在 `useChat` hook 中从 store 获取选中的提示词内容
3. **构建消息历史**：在 `buildMessageHistory` 函数中，如果有系统提示词，将其作为第一条 system 消息添加
4. **API 请求**：消息历史包含 system 消息发送给 AI 服务

```typescript
// 消息结构示例
[
  { role: 'system', content: '提示词内容' },  // 系统提示
  { role: 'user', content: '用户消息1' },
  { role: 'assistant', content: 'AI回复1' },
  { role: 'user', content: '用户消息2' },
  // ...
]
```

### 关键修改点

1. **chatService.ts**
   - `sendMessage`、`generateAIResponse`、`regenerateMessage`、`retryMessage`、`editAndResend` 都支持 `systemPrompt` 参数
   - `buildMessageHistory` 在有系统提示词时，将其添加到消息历史开头

2. **useChat.ts**
   - 从 `usePromptStore` 获取选中的提示词内容
   - 所有调用 chatService 的地方都传递 `systemPrompt`

3. **ChatInput.tsx**
   - 移除了将提示词附加到用户消息的逻辑
   - 用户消息保持原样，不包含提示词内容

## 数据结构

```typescript
interface Prompt {
  id: string;
  name: string;          // 提示词名称
  description: string;   // 简介（在侧边栏显示）
  content: string;       // 完整内容（发送时使用）
  createdAt: number;
  updatedAt: number;
}
```
